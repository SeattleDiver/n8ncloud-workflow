<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>n8n Chatbot + Diamond Filters</title>
  <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { font-size: 24px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; max-width: 600px; }
    th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body> 

<h1>n8n Chatbot Test</h1>
<p>Try a message like: <em>‚ÄúFind me a 3 carat round white diamond‚Äù</em> and your search filters will appear below.</p>

<!-- Chatbot container -->
<div id="n8n-chat-container"></div>

<!-- Filter output panel -->
<h2>Diamond Search Filters</h2>
<div id="diamond-data"><p>No data yet.</p></div>

<script>
// Override fetch to intercept chat responses
const originalFetch = window.fetch;
window.fetch = async (...args) => {
  const response = await originalFetch(...args);

  const cloned = response.clone();
  cloned.json().then(json => {
    if (json && json.data) {
      console.log("üéØ Intercepted chatbot response data:", json.data);
      renderDiamondFilters(json.data);
    }
  }).catch(err => {
    console.warn("Fetch response was not JSON:", err);
  });

  return response;
};

// Display the filter table
function renderDiamondFilters(data) {
  const format = v => Array.isArray(v) ? v.join(', ') : (v ?? '');
  const html = `
    <table>
      <tr><th>Shape</th><td>${format(data.shape)}</td></tr>
      <tr><th>Carat Min</th><td>${format(data.carat_min)}</td></tr>
      <tr><th>Carat Max</th><td>${format(data.carat_max)}</td></tr>
      <tr><th>Color</th><td>${format(data.color)}</td></tr>
      <tr><th>Clarity</th><td>${format(data.clarity)}</td></tr>
      <tr><th>Price Min</th><td>${format(data.price_min)}</td></tr>
      <tr><th>Price Max</th><td>${format(data.price_max)}</td></tr>
      <tr><th>Name</th><td>${format(data.name)}</td></tr>
      <tr><th>Email</th><td>${format(data.email)}</td></tr>
    </table>
  `;
  document.getElementById('diamond-data').innerHTML = html;
}
</script>

<!-- Load chatbot -->
<script type="module">
  import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

  createChat({
    webhookUrl: 'https://app.pureice.ai/webhook/ab985783-46d8-4a88-b47d-39cf43c6d0b4/chat',
    mode: 'inline',
    target: '#n8n-chat-container'
  });
</script>

</body>
</html>
